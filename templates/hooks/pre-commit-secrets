#!/bin/bash
# SPDX-License-Identifier: AGPL-3.0-or-later
# Pre-commit hook to prevent secrets and enforce contact email

# Check for common secret patterns
if git diff --cached --name-only | xargs grep -l -E '(api[_-]?key|secret|password|token)\s*[:=]\s*["\047][^"]+["\047]' 2>/dev/null; then
  echo "ERROR: Potential secret detected. Please remove before committing."
  exit 1
fi

# Check for fake emails
APPROVED_EMAIL="jonathan.jewell@open.ac.uk"
if git diff --cached | grep -E '@(example\.com|localhost|placeholder|fake\.)' 2>/dev/null; then
  echo "ERROR: Fake email detected. Use $APPROVED_EMAIL instead."
  exit 1
fi

exit 0
